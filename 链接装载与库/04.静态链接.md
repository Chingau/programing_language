本章以下面的例子展开：

```c
/* a.c 文件 */
extern int shared;
int main(void)
{
    int a = 100;
    swap(&a, &shared);
}

/* b.c 文件 */
int shared = 1;
void swap(int *a, int *b)
{
    *a ^= *b ^= *a ^= *b;
}
```

经过编译我们得到 a.o, b.o 这两个目标文件。将这两个目标文件链接形成 ab 可执行文件。

# 1. 空间与地址分配
可执行文件中的代码段和数据段都是由输入的目标文件中合并而来，由此产生一个问题：对于多输入目标文件，链接器如何将它们的各个段合并到输出文件？有以下两种方案：

- 按序叠加：就是直接将各个目标文件依次合并；优点就是操作简单，缺点就是输出文件将会有很多零散的段，此由于段地址对齐的原因，会造成大量的空间浪费。
- 相似段合并：将输入的.text合并到输出的.text，其它段都以这种操作。(现在的链接器基本上都采用此种方案)

相似段合并的链接器一般都采用一种叫**两步链接**的方法。也就是说整个链接过程分两步：
- 第一步：**空间与地址分配** —— 扫描所有输入目标文件，获得它们的各个段的长度、属性和位置，并且将输入目标文件中的符号表中所有的符号和符号引用收集起来，统一放到一个全局符号表。这一步中，链接器将能够获得所有输入目标文件的段长度，并且将它们合并，计算出输出文件中各个段合并后的长度和位置，并建立映射关系。
- 第二步：**符号解析与重定位** —— 使用上面第一步中收集到的所有信息，读取输入文件中段的数据、重定位信息，并且进行符号解析与重定位、调整代码中的地址等。此步为链接核心，特别是重定位过程。


