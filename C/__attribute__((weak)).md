# __attribute__((weak)) 简介及作用
## 1. 场景
A,B 两个模块，A模块调用了不确定 B 模块是否提供了函数，但是又不得不调用，这个时候在 A 模块中再申明一个弱符号函数，即用 weak，如果外部提供了该函数则调用外部提供的，如果没提供则调用申明的。

## 2. 弱符号
若两个或两个以上全局符号(函数或变量名)名字一样，而其中一个声明为 weak 属性，则这些全局符号不会引发重定义错误。链接器会忽略弱符号，去使用普通的全局符号来解析所有对这些符号的引用，但当普通的全局符号不可用时，链接器会使用弱符号。当有函数或变量名可能被用户覆盖时，该函数或变量名可以声明为一个弱符号。

说简单点，用弱符号修饰的变量或函数其实就是一个备胎。

## 3. 示例

```c
// 模块 A 中调用 func，但是不确定外部是否提供了该函数
...
extern int func(void);
...
int a = func();
```

如果直接这么调用，并且外部没有提供该函数的程序可能会出现 crash。

所以在本模块中，`__attribute__((weak))` 就派上了用场。在模块 A 中添加如下代码：

```c
int func() __attribute__((weak))
{
    return 0;
}
```

这样的话如果模块 B 提供了 func 函数那实际模块 A 中调用的 func 函数就是模块 B 提供的，如果模块 B 中没有提供 func 函数，那模块 A 就调用自己用 weak 修饰过的 func 函数。